(function(){"use strict";function w(n,r){r=r.map(e=>{if(e.type!=="name"&&e.type!=="character")return e;const t=e.value?.match(/^\/(.+)\/[a-z]*$/);if(!t)return e;const o=new RegExp(t[1],"ui");return{...e,value:o}});let a=[...n.unicodeData.values()];for(const e of r)a=a.filter(t=>{if(e.type==="name")return typeof e.value=="string"?e.negated?!t.label.includes(e.value):t.label.includes(e.value):e.negated?!e.value.test(t.label):e.value.test(t.label);if(e.type==="character"){const o=String.fromCodePoint(t.codepoint);return e.negated?!e.value.test(o):e.value.test(o)}if(e.type==="range"){const[o,i]=e.value;return e.negated?!(t.codepoint>=o&&t.codepoint<=i):t.codepoint>=o&&t.codepoint<=i}if(e.type==="bidi")return e.negated?t.bidiClass!==e.value:t.bidiClass===e.value;throw new Error(`Unknown filter type: ${e.type}`)});return a}function M(n){const r=n.split(`
`).map(a=>{const[e,t,o,i,s,d,u,f,q,R,k,U,g,y,b]=a.split(";"),v=parseInt(e,16),x={codepoint:v,label:t.toLowerCase(),category:o,combiningClass:parseInt(i),bidiClass:s,decompositionStr:d||null,decimalEquiv:u?parseInt(u):null,digitEquiv:f?parseInt(f):null,numericEquiv:q||null,isBidiMirrored:R==="Y",oldName:k||null,uppercaseMapping:g?parseInt(g,16):null,lowercaseMapping:y?parseInt(y,16):null,titlecaseMapping:b?parseInt(b,16):null};return[v,x]});return new Map(r)}function h(n){const r=n.split(`
`).map(a=>{const[e,t]=a.split("; "),[o,i]=e.split(".."),s={name:t,range:[parseInt(o,16),parseInt(i,16)]};return[t,s]});return new Map(r)}function I(n){const r=n.split(`
`).map(a=>{const[e,t]=a.split(";");return[parseInt(e,16),t.split(",")]});return new Map(r)}function S({blocks:n,unicodeData:r,symbolHtmlNames:a}){return{unicodeBlocks:h(n),unicodeData:M(r),symbolHtmlNames:I(a)}}function l(n){return/^[0-9]+$/.test(n)?Number(n):/^(?:0x|U\+)[0-9a-f]+$/i.test(n)?parseInt(n.slice(2),16):/^0b[10]+$/.test(n)?parseInt(n.slice(2),2):null}function E(n){const r=n.split("-");if(r.length!==2)return null;const a=l(r[0].trim());if(!a)return null;const e=l(r[1].trim());return e?[a,e]:null}function C(n){if(!n.includes("*")||!/^[a-zA-Z-* ]+$/.test(n))return null;const r=n.replace(/\*/g,".*");return new RegExp(r,"i")}var m=(n,r)=>[...n.unicodeData.values()].find(a=>a.codepoint===r);function D(n,r){const a=l(r);if(a!==null){const i=m(n,a);return i?[i]:[]}if([...r].length===1){const i=m(n,r.codePointAt(0));return i?[i]:[]}const e=E(r);if(e)return[...n.unicodeData.values()].filter(({codepoint:i})=>i>=e[0]&&i<=e[1]);const t=C(r.trim());if(t)return[...n.unicodeData.values()].filter(({label:i})=>t.test(i));const o=r.match(/\/(.+?)\/([a-z]+)?/);if(o){const{1:i,2:s}=o,d=new RegExp(i,/i/i.test(s)?"ui":"u");return[...n.unicodeData.values()].filter(({codepoint:u})=>d.test(String.fromCodePoint(u)))}return[...n.unicodeData.values()].filter(({label:i})=>i.includes(r))}let c=null;async function p(){if(!c){const[n,r,a]=await Promise.all(["/UnicodeBlocks.txt","/UnicodeData.txt","/SymbolHtmlNames.txt"].map(e=>fetch(e).then(t=>t.text())));c=S({blocks:n,unicodeData:r,symbolHtmlNames:a})}return c}const N=async n=>{const{name:r}=n;if(n.name==="load-table")return await p();if(n.name==="simple-query"){const a=await p(),{payload:e}=n;return D(a,e).map(t=>[t.codepoint,t])}if(r==="advanced-query"){const a=await p(),{payload:e}=n;return w(a,e).map(t=>[t.codepoint,t])}};addEventListener("message",async n=>{self.postMessage({id:n.data.id,payload:await N(n.data)})})})();
